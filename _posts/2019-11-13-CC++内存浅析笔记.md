---
layout:     post
title:      C/C++内存浅析
subtitle:   C/C++内存模型
date:       2019-11-13
author:     Hxd
header-img: img/city.jpg
catalog: true
tags: 
  - C
  - C++
  - 内存管理
---

# 内存是啥？

内存RAM是程序运行的载体，一个程序要被运行首先被操作系统装载到内存空间里，接着程序计数器按照某条指令一行行读内存中记录的值，这个过程就称之为“运行”了。（PS：个人的一个浅显理解）

# 内存的分配方式

这里所说的内存分配方式是指，在运行C++程序时，操作系统为其划分的内存规则。我们在操作系统层面上将内存抽象了，将内存分为几个区域如：代码段、栈、堆。

如一个程序，从进程的角度看，该代码段在内存中的意义可能是:
![undefined](http://ww1.sinaimg.cn/large/9dc4c374gy1g8wh58ztblj20a30aadgd.jpg)

但是在操作系统上看可能就是：
![undefined](http://ww1.sinaimg.cn/large/9dc4c374gy1g8wh67nbuvj207w0bn0u3.jpg)

这样的分配方式包括了各种算法、虚拟地址技术，这里不做讨论。

来看看进程眼中的内存分配。在C++中，内存分为5个区域：**堆、栈、自由存储区、全局/静态存储区和常量存储区**。

- 栈：在执行函数时，函数内局部变量的存储单元都可以在栈上创建，函数执行结束时这些存储单元自动被释放。栈内存分配运算内置于处理器的指令集中，效率很高，但是分配的内存容量有限。使用迭代不当会导致栈溢出。

- 堆：是操作系统所维护的一块特殊内存，用于程序的内存动态分配，C语言使用`malloc`从堆上分配内存，使用`free`释放已分配的对应内存。如不自己释放内存会导致内存泄漏。程序结束后所占内存被操作系统回收。

　　
- 自由存储区：就是那些由`new`分配的内存块，一般一个`new`就要对应一个`delete`。如果程序员没有释放掉，那么在程序结束后，操作系统会自动回收。自由存储区是C++基于`new`操作符的一个抽象概念，凡是通过`new`操作符进行内存申请，该内存即为自由存储区。而堆是操作系统中的术语。
　　
- 全局/静态存储区：全局变量和静态变量被分配到同一块内存中，在以前的C语言中，全局变量又分为初始化的和未初始化的，在C++里面没有这个区分了，他们共同占用同一块内存区。
　　
- 常量存储区：这是一块比较特殊的存储区，他们里面存放的是常量，不允许修改。

参考：

[C/C++内存管理详解](https://chenqx.github.io/2014/09/25/Cpp-Memory-Management/)

[细说new与malloc的10点区别](https://www.cnblogs.com/qg-whz/p/5140930.html)